## خدمة النماذج الديناميكية

تستقبل الخدمة تعريف النموذج عبر Webhook (مثلاً من n8n)، ثم تولد رابطاً فريداً يعرض النموذج بالعربية مع اتجاه RTL. عند تعبئة النموذج يتم إعادة إرسال الردود إلى الـ callback webhook المحدد في الطلب الأول.

### التثبيت والتشغيل المحلي

```bash
npm install
npm run dev
# التطبيق متاح على http://localhost:3000
```

أنشئ ملف `.env.local` وحدد مفتاح التوقيع المستخدم لحماية الروابط:

```
FORM_TOKEN_SECRET=ضع-هنا-سلسلة-طويلة-وعشوائية
```

### إنشاء نموذج جديد

أرسل طلب `POST` إلى `/api/forms` بالصيغة التالية (لاحظ أن كل خدمة ستحصل على مجموعة أزرار راديو تضم جميع الموظفين):

```json
{
  "title": "توزيع المهام اليومية",
  "description": "طلب رقم #4821\\nالخدمات المطلوبة: اشتراك بريميوم + زيارة ميدانية",
  "callbackUrl": "https://n8n.example.com/webhook/form-response",
  "services": [
    { "id": "srv-1", "name": "اشتراك بريميوم" },
    { "id": "srv-2", "name": "زيارة ميدانية" },
    { "id": "srv-3", "name": "استشارة هاتفية" }
  ],
  "workers": [
    { "id": "ali", "name": "علي" },
    { "id": "sara", "name": "سارة" }
  ]
}
```

ستحصل على استجابة مشابهة:

```json
{
  "formUrl": "https://your-app.vercel.app/form/ENCODED_TOKEN",
  "formId": "0dd2f53d-..."
}
```

شارك `formUrl` مع المستخدم. عندما يتم إرسال النموذج، ستتلقى `callbackUrl` حمولة JSON تضم:

```json
{
  "formId": "0dd2f53d-...",
  "formTitle": "توزيع المهام اليومية",
  "description": "طلب رقم #4821\\nالخدمات المطلوبة: اشتراك بريميوم + زيارة ميدانية",
  "assignments": [
    {
      "service": { "id": "srv-1", "name": "اشتراك بريميوم" },
      "worker": { "id": "ali", "name": "علي" }
    },
    {
      "service": { "id": "srv-2", "name": "زيارة ميدانية" },
      "worker": { "id": "sara", "name": "سارة" }
    },
    {
      "service": { "id": "srv-3", "name": "استشارة هاتفية" },
      "worker": { "id": "ali", "name": "علي" }
    }
  ],
  "notes": null,
  "submittedAt": "2025-11-25T09:15:00.000Z"
}
```

يمكن للمستخدم اختيار الموظف ذاته لأكثر من خدمة، لكن يجب إسناد موظف واحد لكل خدمة قبل الإرسال.

### نشر الخدمة

قم بربط المستودع مع Vercel وتشغيل نشر عادي. لا حاجة لقاعدة بيانات لأن تعريف النموذج يُشفّر داخل الرابط نفسه، لكن تأكد من إعداد المتغير البيئي `FORM_TOKEN_SECRET` في إعدادات Vercel.
